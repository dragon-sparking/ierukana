<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>DQ1～7 地名いえるかな</title>
    <style>
        /* ドットフォント風の代替フォント設定 */
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');

        body {
            font-family: 'DotGothic16', 'Hiragino Kaku Gothic ProN', sans-serif;
            text-align: center;
            background-color: #000;
            color: white;
            margin: 0;
            padding: 20px;
        }

        /* 外枠：ドラクエ伝統の白二重枠 */
        .container {
            max-width: 1500px;
            margin: 20px auto;
            background: #000;
            padding: 10px;
            border-radius: 8px;
            border: 4px solid #fff;
            box-shadow: 0 0 0 4px #000, 0 0 0 8px #fff;
        }

        .sticky-header {
            position: sticky;
            top: 0;
            background: #000;
            padding: 20px 0;
            z-index: 100;
            border-bottom: 4px double #fff;
            margin-bottom: 20px;
        }

        h2 {
            margin: 0 0 15px 0;
            color: #fff;
            letter-spacing: 2px;
        }

        /* ゲージ：少し古めのRPG風 */
        .limit-gauge-outer {
            max-width: 500px;
            margin: 15px auto;
            padding: 4px;
            background: #fff;
            border-radius: 0;
        }

        .limit-gauge-bg {
            height: 16px;
            background: #444;
            position: relative;
        }

        #limitFill {
            height: 100%;
            width: 0%;
            background: #00ff00; /* 昔のHPバー風の緑 */
            transition: width 0.3s steps(10); /* カクカク動かす */
        }

        .limit-label {
            position: absolute;
            right: -60px;
            top: -2px;
            font-size: 18px;
            color: #fff;
        }

        .limit-max #limitFill {
            background: linear-gradient(90deg, #ff0000, #ffff00, #ff00ff);
            animation: flash 0.1s infinite;
        }

        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status {
            margin: 10px 0;
            font-size: 1.4em;
            color: #fff;
        }

        #message {
            height: 30px;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #ffff00; /* ドラクエの重要メッセージ色 */
        }

        /* 入力欄：コマンドウィンドウ風 */
        input {
            font-family: 'DotGothic16', sans-serif;
            font-size: 20px;
            padding: 12px;
            width: 50%;
            border: 3px solid #fff;
            background: #000;
            color: #fff;
            outline: none;
        }

        /* ボタン：コマンド選択風 */
        .btn {
            font-family: 'DotGothic16', sans-serif;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            background: #000;
            color: white;
            border: 3px solid #fff;
            margin-left: 10px;
            position: relative;
        }

        .btn:hover::before {
            content: "▶";
            position: absolute;
            left: -20px;
        }

        /* リスト：ステータス画面風 */
        .list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
        }

        .item {
            padding: 8px;
            background: #000;
            border: 2px solid #555;
            color: #555;
            font-size: 16px;
            min-height: 45px;
        }

        /* 発見済み：生存メンバー風 */
        .item.found {
            border-color: #fff;
            color: #fff;
        }

        .item.found .hint-text { color: #aaa; }

        /* 未回答（ギブアップ後）：死亡（赤字）風 */
        .item.missed {
            border-color: #ff0000;
            color: #ff0000;
        }

        .hint-text { font-size: 0.7em; margin-bottom: 2px; }
        .answer-text { font-size: 1em; }

    </style>
</head>
<body>

<div class="container">
    <div class="sticky-header">
        <h2>DQ1～7 地名いえるかな</h2>
        <div class="limit-gauge-outer" id="gaugeWrapper">
            <div class="limit-gauge-bg">
                <div id="limitFill"></div>
                <div class="limit-label" id="progressPercent">0%</div> 
            </div>
        </div>
        <div class="status">のこり： <span id="remaining">--</span> / <span id="total">--</span></div>
        <div id="message"></div>
        <input type="text" id="answerInput" placeholder="なまえを いれてください" autofocus autocomplete="off">
        <button class="btn giveup-btn" id="giveupBtn">にげる</button>
        <button class="btn retry-btn" id="retryBtn" style="display:none;">ふっかつ</button>
    </div>
    <div class="list" id="answerList"></div>
</div>

<script>
    const config = {
        placeholderNormal: "なまえを いれてください",
        placeholderGameOver: "しんでしまうとは なにごとだ！",
        storageKey: "quiz_save_" + document.title
    };

    // クイズデータ（前回の修正版読み仮名付きを使用）
    const quizData = [
        // DQ1
        { display: "ラダトーム", accept: ["ラダトーム", "らだとーむ", "ラダトーム城", "らだとーむじょう", "らだとーむのまち"], hint: "DQ1" },
        { display: "ガライの町", accept: ["ガライ", "がらい", "ガライの町", "がらいのまち"], hint: "DQ1" },
        { display: "マイラ", accept: ["マイラ", "まいら"], hint: "DQ1" },
        { display: "リムルダール", accept: ["リムルダール", "りむるだーる"], hint: "DQ1" },
        { display: "ドムドーラ", accept: ["ドムドーラ", "どむどーら"], hint: "DQ1" },
        { display: "メルキド", accept: ["メルキド", "めるきど"], hint: "DQ1" },

        // DQ2
        { display: "ローレシア", accept: ["ローレシア", "ろーれしあ", "ローレシア城", "ろーれしあじょう"], hint: "DQ2" },
        { display: "リリザ", accept: ["リリザ", "りりざ"], hint: "DQ2" },
        { display: "サマルトリア", accept: ["サマルトリア", "さまるとりあ", "サマルトリア城", "さまるとりあじょう"], hint: "DQ2" },
        { display: "ムーンペタ", accept: ["ムーンペタ", "むーんぺた"], hint: "DQ2" },
        { display: "ムーンブルク", accept: ["ムーンブルク", "むーんぶるく", "ムーンブルク城", "むーんぶるくじょう"], hint: "DQ2" },
        { display: "ルプガナ", accept: ["ルプガナ", "るぷがな"], hint: "DQ2" },
        { display: "ベラヌール", accept: ["ベラヌール", "べらぬーる"], hint: "DQ2" },
        { display: "デルコンダル", accept: ["デルコンダル", "でるこんだる", "デルコンダル城", "でるこんだるじょう"], hint: "DQ2" },
        { display: "ザハン", accept: ["ザハン", "ざはん"], hint: "DQ2" },
        { display: "ペルポイ", accept: ["ペルポイ", "ぺるぽい"], hint: "DQ2" },
        { display: "テパ", accept: ["テパ", "てぱ"], hint: "DQ2" },

        // DQ3
        { display: "アリアハン", accept: ["アリアハン", "ありあはん", "アリアハン城", "ありあはんじょう"], hint: "DQ3" },
        { display: "レーベ", accept: ["レーベ", "れーべ"], hint: "DQ3" },
        { display: "ロマリア", accept: ["ロマリア", "ろまりあ", "ロマリア城", "ろまりあじょう"], hint: "DQ3" },
        { display: "カザーブ", accept: ["カザーブ", "かざーぶ"], hint: "DQ3" },
        { display: "ノアニール", accept: ["ノアニール", "のあにーる"], hint: "DQ3" },
        { display: "エルフの隠れ里", accept: ["エルフの隠れ里", "えるふのかくれざと", "えるふのかくれのさと", "エルフの里", "えるふのさと"], hint: "DQ3" },
        { display: "アッサラーム", accept: ["アッサラーム", "あっさらーむ"], hint: "DQ3" },
        { display: "イシス", accept: ["イシス", "いしす", "イシス城", "いしすじょう"], hint: "DQ3" },
        { display: "ポルトガ", accept: ["ポルトガ", "ぽるとが", "ポルトガ城", "ぽるとがじょう"], hint: "DQ3" },
        { display: "バハラタ", accept: ["バハラタ", "ばはらた"], hint: "DQ3" },
        { display: "ダーマ", accept: ["ダーマ", "だーま", "ダーマの神殿", "だーましんでん", "ダーマ神殿"], hint: "DQ3" },
        { display: "ムオル", accept: ["ムオル", "むおる"], hint: "DQ3" },
        { display: "テドン", accept: ["テドン", "てどん"], hint: "DQ3" },
        { display: "ランシール", accept: ["ランシール", "らんしーる"], hint: "DQ3" },
        { display: "エジンベア", accept: ["エジンベア", "えじんべあ", "エジンベア城", "えじんべあじょう"], hint: "DQ3" },
        { display: "スー", accept: ["スー", "すー", "スーの村", "すーのむら"], hint: "DQ3" },
        { display: "ジパング", accept: ["ジパング", "じぱんぐ"], hint: "DQ3" },
        { display: "ルザミ", accept: ["ルザミ", "るざみ"], hint: "DQ3" },
        { display: "サマンオサ", accept: ["サマンオサ", "さまんおさ", "サマンオサ城", "さまんおさじょう"], hint: "DQ3" },
        { display: "竜の女王の城", accept: ["竜の女王の城", "りゅうのじょおうのしろ", "りゅうのじょおうのじょう"], hint: "DQ3" },

        // DQ4
        { display: "バトランド", accept: ["バトランド", "ばとらんど", "バトランド城", "ばとらんどじょう"], hint: "DQ4" },
        { display: "イムル", accept: ["イムル", "いむる"], hint: "DQ4" },
        { display: "サントハイム", accept: ["サントハイム", "さんとはいむ", "サントハイム城", "さんとはいむじょう"], hint: "DQ4" },
        { display: "サラン", accept: ["サラン", "さらん"], hint: "DQ4" },
        { display: "テンペ", accept: ["テンペ", "てんぺ"], hint: "DQ4" },
        { display: "フレノール", accept: ["フレノール", "ふれのーる"], hint: "DQ4" },
        { display: "砂漠のバザー", accept: ["砂漠のバザー", "さばくのばざー"], hint: "DQ4" },
        { display: "エンドール", accept: ["エンドール", "えんどーる", "エンドール城", "えんどーるじょう"], hint: "DQ4" },
        { display: "レイクナバ", accept: ["レイクナバ", "れいくなば"], hint: "DQ4" },
        { display: "ボンモール北の村", accept: ["ボンモール北の村", "ぼんもーるきたのむら"], hint: "DQ4" },
        { display: "ボンモール", accept: ["ボンモール", "ぼんもーる", "ボンモール城", "ぼんもーるじょう"], hint: "DQ4" },
        { display: "モンバーバラ", accept: ["モンバーバラ", "もんばーばら"], hint: "DQ4" },
        { display: "コーミズ", accept: ["コーミズ", "こーみず"], hint: "DQ4" },
        { display: "キングレオ城", accept: ["キングレオ", "きんぐれお", "キングレオ城", "きんぐれおじょう"], hint: "DQ4" },
        { display: "ハバリア", accept: ["ハバリア", "はばりあ"], hint: "DQ4" },
        { display: "アッテムト", accept: ["アッテムト", "あってむと"], hint: "DQ4" },
        { display: "山奥の村", accept: ["山奥の村", "やまおくのむら"], hint: "DQ4" },
        { display: "ブランカ", accept: ["ブランカ", "ぶらんか", "ブランカ城", "ぶらんかじょう"], hint: "DQ4" },
        { display: "アネイル", accept: ["アネイル", "あねいる"], hint: "DQ4" },
        { display: "コナンベリー", accept: ["コナンベリー", "こなんべりー"], hint: "DQ4" },
        { display: "ミントス", accept: ["ミントス", "みんとす"], hint: "DQ4" },
        { display: "ソレッタ", accept: ["ソレッタ", "それった", "ソレッタ城", "それったじょう"], hint: "DQ4" },
        { display: "海辺の村", accept: ["海辺の村", "うみべのむら"], hint: "DQ4" },
        { display: "スタンシアラ", accept: ["スタンシアラ", "すたんしあら", "スタンシアラ城", "すたんしあらじょう"], hint: "DQ4" },
        { display: "ガーデンブルグ", accept: ["ガーデンブルグ", "がーでんぶるぐ", "ガーデンブルグ城", "がーでんぶるぐじょう"], hint: "DQ4" },
        { display: "メダル王の城", accept: ["メダル王の城", "めだるおうのしろ", "めだるおうのじょう"], hint: "DQ4" },
        { display: "ロザリーヒル", accept: ["ロザリーヒル", "ろざりーひる"], hint: "DQ4" },
        { display: "リバーサイド", accept: ["リバーサイド", "りばーさいど"], hint: "DQ4" },
        { display: "デスパレス", accept: ["デスパレス", "ですぱれす"], hint: "DQ4" },
        { display: "エルフの里", accept: ["エルフの里", "えるふのさと"], hint: "DQ4" },
        { display: "ゴットサイド", accept: ["ゴットサイド", "ごっとさいど"], hint: "DQ4" },
        { display: "天空城", accept: ["天空城", "てんくうじょう"], hint: "DQ4" },

        // DQ5
        { display: "サンタローズ", accept: ["サンタローズ", "さんたろーず"], hint: "DQ5" },
        { display: "アルカパ", accept: ["アルカパ", "あるかぱ"], hint: "DQ5" },
        { display: "妖精の村", accept: ["妖精の村", "ようせいのむら"], hint: "DQ5" },
        { display: "ラインハット", accept: ["ラインハット", "らいんはっと", "ラインハット城", "らいんはっとじょう"], hint: "DQ5" },
        { display: "オラクルベリー", accept: ["オラクルベリー", "おらくるべりー"], hint: "DQ5" },
        { display: "ポートセルミ", accept: ["ポートセルミ", "ぽーとせるみ"], hint: "DQ5" },
        { display: "カボチ", accept: ["カボチ", "かぼち", "カボチ村", "かぼちむら"], hint: "DQ5" },
        { display: "ルラフェン", accept: ["ルラフェン", "るらふぇん"], hint: "DQ5" },
        { display: "サラボナ", accept: ["サラボナ", "さらぼな"], hint: "DQ5" },
        { display: "テルパドール", accept: ["テルパドール", "てるぱどーる", "テルパドール城", "てるぱどーるじょう"], hint: "DQ5" },
        { display: "チゾット", accept: ["チゾット", "ちぞっと", "チゾットの村", "ちぞっとのむら"], hint: "DQ5" },
        { display: "グランバニア", accept: ["グランバニア", "ぐらんばにあ", "グランバニア城", "ぐらんばにあじょう"], hint: "DQ5" },
        { display: "エルヘブン", accept: ["エルヘブン", "えるへぶん"], hint: "DQ5" },
        { display: "妖精の城", accept: ["妖精の城", "ようせいのしろ", "ようせいのじょう"], hint: "DQ5" },
        { display: "ジャハンナ", accept: ["ジャハンナ", "じゃはんな"], hint: "DQ5" },

        // DQ6
        { display: "ライフコッド", accept: ["ライフコッド", "らいふこっど"], hint: "DQ6" },
        { display: "マルシェ / シエーナ", accept: ["シエーナ", "しえーな", "マルシェ", "まるしぇ"], hint: "DQ6" },
        { display: "トルッカ", accept: ["トルッカ", "とるっか"], hint: "DQ6" },
        { display: "レイドック", accept: ["レイドック", "れいどっく", "レイドック城", "れいどっくじょう"], hint: "DQ6" },
        { display: "サンマリーノ", accept: ["サンマリーノ", "さんまりーの"], hint: "DQ6" },
        { display: "アモール", accept: ["アモール", "あもーる"], hint: "DQ6" },
        { display: "ゲントの村", accept: ["ゲントの村", "げんとのむら", "ゲント", "げんと"], hint: "DQ6" },
        { display: "モンストル", accept: ["モンストル", "もんすとる"], hint: "DQ6" },
        { display: "アークボルト", accept: ["アークボルト", "あーくぼると", "アークボルト城", "あーくぼるとじょう"], hint: "DQ6" },
        { display: "カルカド", accept: ["カルカド", "かるかど"], hint: "DQ6" },
        { display: "ホルコッタ", accept: ["ホルコッタ", "ほるこった"], hint: "DQ6" },
        { display: "ホルストック", accept: ["ホルストック", "ほるすとっく", "ホルストック城", "ほるすとっくじょう"], hint: "DQ6" },
        { display: "クリアベール", accept: ["クリアベール", "くりあべーる"], hint: "DQ6" },
        { display: "フォーン城", accept: ["フォーン", "ふぉーん", "フォーン城", "ふぉーんじょう"], hint: "DQ6" },
        { display: "ペスカニ", accept: ["ペスカニ", "ぺすかに"], hint: "DQ6" },
        { display: "ポセイドン城", accept: ["ポセイドン城", "ぽせいどんじょう", "ぽせいどんのしろ"], hint: "DQ6" },
        { display: "ルビスの城", accept: ["ルビスの城", "るびすのしろ", "るびすのじょう"], hint: "DQ6" },
        { display: "マウントスノー", accept: ["マウントスノー", "まうんとすのー"], hint: "DQ6" },
        { display: "ロンガデセオ", accept: ["ロンガデセオ", "ろんがでせお"], hint: "DQ6" },
        { display: "カルベローナ", accept: ["カルベローナ", "かるべろーな"], hint: "DQ6" },
        { display: "ガンディーノ", accept: ["ガンディーノ", "がんでぃーの", "ガンディーノ城", "がんでぃーのじょう"], hint: "DQ6" },
        { display: "グレイス城", accept: ["グレイス", "ぐれいす", "グレイス城", "ぐれいすじょう"], hint: "DQ6" },
        { display: "ゼニスの城", accept: ["ゼニスの城", "ぜにすのしろ", "ぜにすのじょう"], hint: "DQ6" },
        { display: "絶望の町", accept: ["絶望の町", "ぜつぼうのまち"], hint: "DQ6" },
        { display: "ザクソン", accept: ["ザクソン", "ざくそん", "ザクソンの村", "ざくそんのむら"], hint: "DQ6" },
        { display: "欲望の町", accept: ["欲望の町", "よくぼうのまち"], hint: "DQ6" },
        { display: "牢獄の町", accept: ["牢獄の町", "ろうごくのまち"], hint: "DQ6" },
        { display: "デスコッド", accept: ["デスコッド", "ですこっど"], hint: "DQ6" },

        // DQ7
        { display: "フィッシュベル", accept: ["フィッシュベル", "ふぃっしゅべる"], hint: "DQ7" },
        { display: "グランエスタード", accept: ["グランエスタード", "ぐらんえすたーど", "グランエスタード城", "ぐらんえすたーどじょう"], hint: "DQ7" },
        { display: "ウッドパルナ", accept: ["ウッドパルナ", "うっどぱるな"], hint: "DQ7" },
        { display: "エンゴウ", accept: ["エンゴウ", "えんごう"], hint: "DQ7" },
        { display: "ダイアラック", accept: ["ダイアラック", "だいあらっく"], hint: "DQ7" },
        { display: "オルフィー", accept: ["オルフィー", "おるふぃー"], hint: "DQ7" },
        { display: "フォロッド城", accept: ["フォロッド", "ふぉろっど", "フォロッド城", "ふぉろっどじょう"], hint: "DQ7" },
        { display: "フォーリッシュ", accept: ["フォーリッシュ", "ふぉーりっしゅ"], hint: "DQ7" },
        { display: "グリンフレーク", accept: ["グリンフレーク", "ぐりんふれーく"], hint: "DQ7" },
        { display: "メモリアリーフ", accept: ["メモリアリーフ", "めもりありーふ"], hint: "DQ7" },
        { display: "ユバール族の休息地", accept: ["ユバール族の休息地", "ゆばーるぞくのきゅうそくち", "ユバールの休息地", "ゆばーるのきゅうそくち", "ゆばーる"], hint: "DQ7" },
        { display: "ふきだまりの町", accept: ["ふきだまりの町", "ふきだまりのまち"], hint: "DQ7" },
        { display: "山肌の集落", accept: ["山肌の集落", "やまはだのしゅうらく"], hint: "DQ7" },
        { display: "メザレ", accept: ["メザレ", "めざれ"], hint: "DQ7" },
        { display: "砂漠の城", accept: ["砂漠の城", "さばくのしろ", "さばくのじょう"], hint: "DQ7" },
        { display: "砂漠の村", accept: ["砂漠の村", "さばくのむら"], hint: "DQ7" },
        { display: "クレージュ", accept: ["クレージュ", "くれーじゅ"], hint: "DQ7" },
        { display: "リートルード", accept: ["リートルード", "りーとるーど"], hint: "DQ7" },
        { display: "アボン", accept: ["アボン", "あぼん", "アボンの村", "あぼんのむら"], hint: "DQ7" },
        { display: "フズ", accept: ["フズ", "ふず", "フズの村", "ふずのむら"], hint: "DQ7" },
        { display: "ハーメリア", accept: ["ハーメリア", "はーめりあ"], hint: "DQ7" },
        { display: "プロビナ", accept: ["プロビナ", "ぷろびな"], hint: "DQ7" },
        { display: "ルーメン", accept: ["ルーメン", "るーめん"], hint: "DQ7" },
        { display: "ラグラーズ", accept: ["ラグラーズ", "らぐらーず", "ラグラーズ城", "らぐらーずじょう"], hint: "DQ7" },
        { display: "マーディラス", accept: ["マーディラス", "まーでぃらす", "マーディラス城", "まーでぃらすじょう"], hint: "DQ7" },
        { display: "聖風の谷", accept: ["聖風の谷", "せいふうのたに"], hint: "DQ7" },
        { display: "守り人の集落", accept: ["守り人の集落", "まもりびとのしゅうらく", "もりびとのしゅうらく"], hint: "DQ7" },
        { display: "レブレサック", accept: ["レブレサック", "れぶれさっく"], hint: "DQ7" },
        { display: "コスタール", accept: ["コスタール", "こすたーる", "コスタール城", "こすたーるじょう"], hint: "DQ7" },
        { display: "天上の神殿", accept: ["天上の神殿", "てんじょうのしんでん"], hint: "DQ7" },
        { display: "始祖たちの村", accept: ["始祖たちの村", "しそたちのむら"], hint: "DQ7" },
    ];

    let foundCount = 0;
    let isGameOver = false;
    let answeredIndices = new Set();

    const input = document.getElementById('answerInput');
    const remainingText = document.getElementById('remaining');
    const totalText = document.getElementById('total');
    const listContainer = document.getElementById('answerList');
    const messageEl = document.getElementById('message');
    const giveupBtn = document.getElementById('giveupBtn');
    const retryBtn = document.getElementById('retryBtn');
    const limitFill = document.getElementById('limitFill');
    const gaugeWrapper = document.getElementById('gaugeWrapper');
    const percentDisplay = document.getElementById('progressPercent');

    function updateLimitGauge() {
        const percent = Math.floor((foundCount / quizData.length) * 100);
        if(limitFill) limitFill.style.width = percent + "%";
        if (percentDisplay) {
            percentDisplay.textContent = (foundCount === quizData.length) ? "LEVEL MAX!!" : percent + "%";
        }
        if (foundCount === quizData.length && quizData.length > 0) {
            gaugeWrapper.classList.add('limit-max');
        } else {
            gaugeWrapper.classList.remove('limit-max');
        }
    }

    function init() {
        foundCount = 0;
        isGameOver = false;
        answeredIndices.clear();
        listContainer.innerHTML = '';
        input.disabled = false;
        input.value = '';
        input.placeholder = config.placeholderNormal;
        giveupBtn.style.display = 'inline-block';
        retryBtn.style.display = 'none';
        remainingText.textContent = quizData.length;
        totalText.textContent = quizData.length;
        messageEl.textContent = '▼ たびの　おもいでを　よびおこせ！';

        quizData.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'item';
            div.id = 'target-' + index;
            div.innerHTML = `<div class="answer-text">${item.hint}</div>`;
            listContainer.appendChild(div);
        });

        loadProgress();
        updateLimitGauge();
    }

    function loadProgress() {
        const savedData = localStorage.getItem(config.storageKey);
        if (savedData) {
            const savedIndices = JSON.parse(savedData);
            savedIndices.forEach(index => {
                if (index < quizData.length) {
                    answeredIndices.add(index);
                    updateItemDisplay(index, true);
                    foundCount++;
                }
            });
            remainingText.textContent = quizData.length - foundCount;
            if (foundCount > 0) showMessage("▼ ぼうけんのしょから　さいかいします", "#fff");
        }
        updateLimitGauge();
    }

    function saveProgress() {
        localStorage.setItem(config.storageKey, JSON.stringify(Array.from(answeredIndices)));
    }

    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !isGameOver) {
            const val = input.value.trim();
            if (val === "") return;
            let targetIndex = quizData.findIndex(item => item.accept.includes(val));

            if (targetIndex !== -1) {
                if (answeredIndices.has(targetIndex)) {
                    showMessage("▼ すでに　みつけている！", "#ffff00");
                    document.getElementById('target-' + targetIndex).scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    answeredIndices.add(targetIndex);
                    updateItemDisplay(targetIndex, true);
                    foundCount++;
                    remainingText.textContent = quizData.length - foundCount;
                    showMessage("▼ おもいだした！", "#00ff00");
                    saveProgress();
                    updateLimitGauge();
                    if (foundCount === quizData.length) finishGame("▼ すべての　ちを　せいはした！", "#ffff00");
                }
            } else {
                showMessage("▼ しかし　なにも　おもいだせなかった！", "#ff4444");
            }
            input.value = '';
        }
    });

    function updateItemDisplay(index, isCorrect) {
        const targetEl = document.getElementById('target-' + index);
        const data = quizData[index];
        targetEl.innerHTML = `
            <div class="hint-text">${data.hint}</div>
            <div class="answer-text">${data.display}</div>
        `;
        if (isCorrect) {
            targetEl.classList.add('found');
            targetEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            targetEl.classList.add('missed');
        }
    }

    giveupBtn.addEventListener('click', () => {
        revealAllAnswers();
        finishGame("▼ たびは　おわってしまった…", "#fff");
    });

    retryBtn.addEventListener('click', () => {
        if(confirm("ぼうけんのしょを　けして　はじめから　やりなおしますか？")) {
            localStorage.removeItem(config.storageKey);
            init();
        }
    });

    function revealAllAnswers() {
        quizData.forEach((item, index) => {
            if (!answeredIndices.has(index)) updateItemDisplay(index, false);
        });
    }

    function finishGame(msg, color) {
        isGameOver = true;
        input.disabled = true;
        input.placeholder = config.placeholderGameOver;
        giveupBtn.style.display = 'none';
        retryBtn.style.display = 'inline-block';
        showMessage(msg, color);
    }

    function showMessage(text, color) {
        messageEl.textContent = text;
        messageEl.style.color = color;
    }

    init();
</script>

</body>
</html>